# Eitor 实现原理说明

## 1. 核心数据结构

### 1.1 Gap Buffer
`GapBuffer` 是编辑器的核心数据结构，用于高效地处理文本插入和删除操作。其实现位于 `buffer.h` 和 `buffer.c` 中。

主要特点：
- 在当前编辑位置维护一个"间隙"(gap)
- 插入操作直接在gap中进行，无需移动大量数据
- 删除操作通过扩大gap实现
- 当gap空间不足时，自动扩展缓冲区

### 1.2 编辑器状态
`Editor` 结构体维护编辑器的整体状态，包括：
- 文本缓冲区
- 光标位置
- 屏幕尺寸
- 编辑模式
- 命令缓冲区
- 剪贴板

## 2. 终端处理

终端相关功能在 `terminal.h` 和 `terminal.c` 中实现，主要包括：

- 终端模式设置：禁用回显和行缓冲
- 光标控制：移动和可见性
- 屏幕清理和刷新
- 按键读取：支持特殊键（方向键等）
- 跨平台支持：Windows 和 Unix 

## 3. 编辑器功能

### 3.1 模式系统
实现了三种编辑模式：
- 普通模式：用于导航和命令输入
- 插入模式：用于文本编辑
- 命令模式：用于执行保存、退出等操作

### 3.2 文本操作
核心文本操作包括：
- 插入字符
- 删除字符
- 光标移动
- 复制/粘贴行

### 3.3 文件操作
支持基本的文件操作：
- 打开文件
- 保存文件
- 脏标记管理

## 4. 渲染系统

渲染过程的主要步骤：
1. 清空屏幕
2. 逐行渲染文本内容
3. 渲染状态行（显示当前模式）
4. 将光标移动到正确位置

## 5. 主循环

主程序循环执行以下步骤：
1. 渲染编辑器状态
2. 读取用户输入
3. 根据当前模式处理输入
4. 更新编辑器状态

## 6. 内存管理

项目采用手动内存管理：
- 使用malloc/free管理动态内存
- 在适当位置检查内存分配失败
- 确保资源在错误情况下正确释放
- 退出时清理所有资源